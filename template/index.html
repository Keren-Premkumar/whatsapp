<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Message Scheduler</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <style>
        /* Your existing styles here */
    </style>
</head>
<body>
    <div class="container">
        <h1>WhatsApp Message Scheduler</h1>
        
        <form id="scheduleForm">
            <div class="form-group">
                <label for="receiver">Receiver Name:</label>
                <input type="text" id="receiver" required>
            </div>
            
            <div class="form-group">
                <label for="message">Message:</label>
                <textarea id="message" rows="4" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="time">Time:</label>
                <input type="time" id="time" required>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="repeat_daily">
                <label for="repeat_daily">Repeat Daily</label>
            </div>
            
            <button type="submit">Schedule Message</button>
        </form>

        <div class="scheduled-messages">
            <h2>Scheduled Messages</h2>
            <div id="messagesList"></div>
        </div>
    </div>

    <script>
        // Function to load scheduled messages from Flask
        function loadMessages() {
            axios.get('/get_messages')
                .then(response => {
                    const messagesList = document.getElementById('messagesList');
                    messagesList.innerHTML = ''; // Clear previous messages

                    // Display all scheduled messages
                    response.data.forEach(msg => {
                        const messageCard = document.createElement('div');
                        messageCard.className = 'message-card';
                        messageCard.innerHTML = `
                            <button class="delete-btn" onclick="deleteMessage('${msg.receiver}', '${msg.message}', '${msg.time}')">Ã—</button>
                            <strong>To:</strong> ${msg.receiver}<br>
                            <strong>Message:</strong> ${msg.message}<br>
                            <strong>Time:</strong> ${msg.time}<br>
                            <strong>Repeat Daily:</strong> ${msg.repeat_daily ? 'Yes' : 'No'}
                        `;
                        messagesList.appendChild(messageCard);
                    });
                })
                .catch(error => console.error('Error loading messages:', error));
        }

        // Event listener to handle message scheduling
        document.getElementById('scheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();  // Prevent form submission

            // Gather data from the form
            const data = {
                receiver: document.getElementById('receiver').value,
                message: document.getElementById('message').value,
                time: document.getElementById('time').value,
                repeat_daily: document.getElementById('repeat_daily').checked
            };

            // Send data to the Flask backend to schedule the message
            axios.post('/schedule', data)
                .then(response => {
                    loadMessages();  // Reload scheduled messages after scheduling
                    this.reset();    // Reset the form after submission
                })
                .catch(error => console.error('Error scheduling message:', error));
        });

        // Function to delete a scheduled message
        function deleteMessage(receiver, message, time) {
            // Send data to the Flask backend to delete the message
            axios.post('/delete_message', { receiver, message, time })
                .then(response => loadMessages())  // Reload after deletion
                .catch(error => console.error('Error deleting message:', error));
        }

        // Initial load of messages when the page is loaded
        loadMessages();
    </script>
</body>
</html>
